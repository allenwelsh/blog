### 浏览器进程与线程

#### 一、浏览器是多进程

浏览器进程主要包含：

- Browser 进程：浏览器的主进程（负责协调，主控）
  - 与用户交互。如前进，后退等
  - 负责各个页面的管理，创建和销毁其他进程
  - 将 Renderer 进程得到的内存中的 Bitmap，绘制到用户界面上
  - 网络资源的管理，下载等
- 第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建
- GPU 进程：最多一个，用于 3D 绘制
- 浏览器内核进程（也叫渲染进程）：默认每个 Tab 页面一个进程，互不影响，控制页面渲染，脚本执行，事件处理等

浏览器多进程的好处：

- 每个一个 tab 崩溃，不会影响到其他 tab
- 多进程充分利用多核优势
- 方便使用沙盒模型隔离插件等进程，提高浏览器稳定性

#### 二、浏浏览器内核进程（也叫渲染进程）是多线程的

渲染进程主要包含：

- GUI 渲染线程

  - 负责解析和构建 dom 树和 css 树、负责 layout、绘制

- js 引擎
  - 也叫 js 内核
  - 负责处理 js 脚本
  - JS 引擎一直等待着任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer 进程）中无论什么时候都只有一个 JS 线程在运行 JS 程序
- 事件触发线程

  - 归属于浏览器而不是 JS 引擎，用来控制事件循环（可以理解，JS 引擎自己都忙不过来，需要浏览器另开线程协助）
  - 当 JS 引擎执行代码块如 setTimeOut 时（也可来自浏览器内核的其他线程,如鼠标点击、AJAX 异步请求等），会将对应任务添加到事件线程中

- 定时器线程
  - setInterval 与 setTimeout 所在线程
- 网络线程
  - 在 XMLHttpRequest 在连接后是通过浏览器新开一个线程请求

###### ** GUI 线程与 js 引擎互斥 **

- 当执行 js 引擎当时候 gui 是被挂起，所以如果 JS 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞

#### 三、WebWorker

- 创建 Worker 时，JS 引擎向浏览器申请开一个子线程（子线程是浏览器开的，完全受主线程控制，而且不能操作 DOM）
- JS 引擎线程与 worker 线程间通过特定的方式通信（postMessage API，需要通过序列化对象来与线程交互特定的数据）
- 如果有非常耗时的工作，请单独开一个 Worker 线程，这样里面不管如何翻天覆地都不会影响 JS 引擎主线程
- WebWorker 只属于某个页面，不会和其他页面的 Render 进程（浏览器内核进程）共享

#### 关键记忆点

- 进程是内存分配的最小单位，而线程是 cpu 最小调度单位，一个进程可以有多个或者单个线程

[线程](https://segmentfault.com/a/1190000012925872)
